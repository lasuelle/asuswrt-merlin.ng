name: Build RT-AX58U_V2 Firmware (Docker Toolchain)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:

      # -------------------------------------------------------
      # 1. Checkout source
      # -------------------------------------------------------
      - name: Checkout source
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # -------------------------------------------------------
      # 2. Ensure GitHub Workspace permissions inside Docker
      # -------------------------------------------------------
      - name: Fix ownership of workspace
        run: |
          sudo chown -R $USER:$USER ${{ github.workspace }}

      # -------------------------------------------------------
      # 3. Prepare writable paths (ONLY required dirs)
      # -------------------------------------------------------
      - name: Prepare build directories
        run: |
          sudo chmod -R 777 release/src-rt-5.04axhnd.675x || true
          sudo chmod -R 777 release/src/router || true
